<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <title>order page</title>
    <link rel="stylesheet" type="text/css" href="Customer_Order.css"/>
</head>
<body>
    <h1>도서 주문 페이지</h1>
    <span><p id="buyer_id">구매자 아이디 : <input type="text"></p></span>
    
    <table id="order_box">
        <input type="checkbox" id="choose_all" onclick="update_Choose_All()">모두 선택
        <thead>
        <tr>
            <td>선택</td>
            <td>상품명</td>
            <td>미리보기</td>
            <td>정가</td>
            <td>수량</td>
            <td>합계</td>
        </tr>
        </thead>
        <tbody id="tbody" name="tbody">
                <?php
                $filename = "./data/booklist.txt";
                $fp = fopen($filename, "r");
                while(!feof($fp))
                {
                    $buffer .= fread($fp, 1024);
                }
                $list_array = explode("\n", $buffer);   // give booklist.txt's each line a index :: $list_array의 데이터로 저장될 때 마지막 데이터에 "\n"가 추가로 존재해서 배열이 한줄 더 증가됨
                makeProductTable($list_array);

                fclose($fp);

                function makeProductTable($bookList)
                {
                    $size = count($bookList)-1;
                    for($i=0; $i<$size; $i++)
                    {
                        write_table($bookList[$i], $i);
                    }
                }
                function write_Table($book_data, $obj_num)
                {
                    $list_book_atr = explode("|", $book_data);
                    $total_value = htmlspecialchars($list_book_atr[1]) * htmlspecialchars($list_book_atr[2]);

                    echo "<tr>";
                    echo "<td><input type='checkbox' name='choose' onclick='update_Choose_Product();'></td>";
                    echo "<td><span id='pname_" . $obj_num . "'>" . htmlspecialchars($list_book_atr[0]) . "</span></td>";
                    echo "<td><button><a href='" . htmlspecialchars($list_book_atr[3]) . "'>미리보기</a></button></td>";
                    echo "<td><span id='price_" . $obj_num . "'>" . htmlspecialchars($list_book_atr[1]) . "</span></td>";
                    echo "<td><input type='number' id='amount_" . $obj_num . "' value='" . htmlspecialchars($list_book_atr[2]) . "' max='" . htmlspecialchars($list_book_atr[2]) . "' min='0'><input type='button' value='변경'></td>";
                    echo "<td><span id='total_value'>" . $total_value . "</span></td>";
                    echo "</tr>";
                }
                ?>        
        </tbody>
        <tfoot>
            <tr>
                <td colspan="5" ><strong>선택한 총 상품 금액</strong></td>
                <td id="total_cost" name="total_cost"><span id='value'><?php echo htmlspecialchars(0); ?></span></td>
            </tr>
        </tfoot>
    </table>

    <div id="show_chosen">총 <span id="chosen"><?php echo htmlspecialchars(0); ?></span>개 상품 선택</div>
    <span><input type="button" value="삭제하기"><input type="button" value="주문하기"></span>
    <!--<?php include './Read_product.php';?>-->
    <script src="Read_product.js"></script>
</body>
</html>